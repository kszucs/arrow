name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        builder:
        - "AMD64 Debian 9 Rust 1.35"
        - "AMD64 Debian 9 Go 1.11.11"
        - "AMD64 Debian 9 Go 1.12.6"
        - "AMD64 Conda C++"
        - "AMD64 Conda Python 2.7"
        - "AMD64 Conda Python 3.6"
        - "AMD64 Conda Python 3.7"

    steps:

    - name: Checkout Ursabot
      uses: actions/checkout@v1
      with:
        repository: ursa-labs/ursabot
        ref: refs/heads/master
        path: ursabot
    - name: Install Python
      uses: actions/setup-python@v1
      with:
        python-version: '3.7'
    - name: Install Ursabot
      run: pip install -e ../ursabot
    - name: Check Ursabot Command
      run: ursabot --help

    - name: Run ${{ matrix.builder }} Builder
      run: |
        cd ../ursabot/projects/arrow
        ursabot project build \
          --repo https://github.com/$GITHUB_REPOSITORY \
          --branch $GITHUB_REF \
          --commit $GITHUB_SHA \
          "${{ matrix.builder }}"

